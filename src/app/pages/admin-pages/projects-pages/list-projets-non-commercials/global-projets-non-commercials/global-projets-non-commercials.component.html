<div class="pc-container">
    <div class="pc-content">

        <div class="container mb-2">
            <div class="d-flex justify-content-center">
                <div class="m-3">
                    <button (click)="goToListeGlobalProjet()" mat-fab extended [color]="is_global_projet == true?'primary':''">
                        <mat-icon class="me-2">list</mat-icon>
                        Liste des projets globaux
                    </button>
                </div>
                <div class="m-3">
                    <button mat-fab extended (click)="goToListeAssignedProjet()" [color]="is_assigned_projet == true?'primary':''">
                        <mat-icon class="me-2">checklist</mat-icon>
                        Liste des projets imputés
                    </button>
                </div>
            </div>
        </div>
        <div class="row" *ngIf="is_global_projet == true">
            <div class="card table-card px-0">
                <div class="card-header">
                    <div class="row align-items-center justify-content-between g-2">
                        <div class="col-auto">
                            <button mat-button><mat-icon>list</mat-icon>Liste des projets globaux <span
                                    class="fw-bold">(Organisations)</span> </button>
                        </div>
                        <div class="col-5">
                            <div class="form-search">
                                <i class="ti ti-search"></i>
                                <input type="search" class="form-control" placeholder="Rechercher un projet">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover table-bordered">
                            <thead class="bg-light">
                                <tr>
                                    <th class="fst-italic">#ID</th>
                                    <th class="text-wrap text-center">TITRE DU PROJET</th>
                                    <th class="text-wrap text-center">TYPE DE SOUMISSIONNAIRE</th>
                                    <th class="text-wrap text-center">CODE REF.</th>
                                    <th class="text-wrap text-center text-uppercase">Statut du projet</th>
                                    <th *ngIf="_visitor == false" class="text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr [class]="projet.admin_new_actions == 1?'bg-news-actions-off':'bg-news-actions-on'"
                                    *ngFor="let projet of _liste_global_projet | paginate: { itemsPerPage: 20, currentPage: p }; let i=index">
                                    <td>{{ i+1 }}</td>
                                    <td style="cursor: pointer" [routerLink]="['/web.administration.non-commercial.show-project-seleted-details', projet.project_code]">
                                        {{ projet.titre_projet }}</td>
                                    <td style="cursor: pointer" [routerLink]="['/web.administration.non-commercial.show-project-seleted-details', projet.project_code]">{{ projet.category_projet }}</td>


                                    <td style="cursor: pointer" matTooltip="Cliquer pour copier le code">
                                        <button (click)="openSnackBar(projet.project_code)" mat-mini-fab color="default"
                                        class="mat-elevation-z0" [cdkCopyToClipboard]="projet.project_code">
                                            <mat-icon aria-hidden="false" fontIcon="content_copy"></mat-icon>
                                        </button>
                                    </td>
                                    <td *ngIf="_visitor == true">

                                        <!-- IMPUTATION -->
                                            <button mat-button *ngIf="
                                            period(projet, projet.created_at | date: 'yyyy-MM-dd') == false &&
                                            projet.status == 0" class="bg-warning text-white rounded-pill ">
                                                <mat-icon class="fa-2x me-1">quiz</mat-icon>
                                                Attente d’imputation
                                            </button>

                                        <!-- INTRUCTEUR -->
                                            <button mat-button *ngIf="
                                                period(projet, projet.created_at | date: 'yyyy-MM-dd') == false &&
                                                projet.status == 1 && projet.status_decret_decision == 0
                                            " class="bg-warning text-white rounded-pill ">
                                                <mat-icon class="fa-2x me-1">hourglass_top</mat-icon>
                                                En cours examen niveau 1
                                            </button>

                                            <button mat-button *ngIf="
                                                period(projet, projet.created_at | date: 'yyyy-MM-dd') == false &&
                                                projet.status_decret_decision == 1 &&
                                                projet.status_decisions_on == 0 &&
                                                projet.status_decisions_off == 0
                                            " class="bg-warning text-white rounded-pill ">
                                                <mat-icon class="fa-2x me-1">hourglass_top</mat-icon>
                                                En cours examen niveau 2
                                            </button>

                                        <!-- DECISION -->
                                            <button mat-button *ngIf="period(projet, projet.created_at | date: 'yyyy-MM-dd') == false &&
                                            (projet.status_decisions_on == 1 || projet.status_decisions_off == 1)" class="bg-success text-white rounded-pill ">
                                                <mat-icon class="fa-2x me-1">task</mat-icon>
                                                Terminé
                                            </button>

                                            <button mat-button *ngIf="period(projet, projet.created_at | date: 'yyyy-MM-dd')" class="bg-danger text-white rounded-pill ">
                                                <mat-icon class="fa-2x me-1">more_time</mat-icon>
                                                Suspendu
                                            </button>
                                    </td>
                                    <td *ngIf="_visitor == false">

                                        <!-- IMPUTATION -->
                                            <button mat-button *ngIf="
                                            period(projet, projet.created_at | date: 'yyyy-MM-dd') == false &&
                                            projet.status == 0" class="bg-warning text-white rounded-pill ">
                                                <mat-icon class="fa-2x me-1">quiz</mat-icon>
                                                Attente d’imputation
                                            </button>

                                        <!-- INTRUCTEUR -->
                                            <button mat-button *ngIf="
                                                period(projet, projet.created_at | date: 'yyyy-MM-dd') == false &&
                                                projet.status == 1 && projet.status_decret_decision == 0
                                            " class="bg-warning text-white rounded-pill ">
                                                <mat-icon class="fa-2x me-1">hourglass_top</mat-icon>
                                                En cours examen niveau 1
                                            </button>

                                            <button mat-button *ngIf="
                                                period(projet, projet.created_at | date: 'yyyy-MM-dd') == false &&
                                                projet.status_decret_decision == 1 &&
                                                projet.status_decisions_on == 0 &&
                                                projet.status_decisions_off == 0
                                            " class="bg-warning text-white rounded-pill ">
                                                <mat-icon class="fa-2x me-1">hourglass_top</mat-icon>
                                                En cours examen niveau 2
                                            </button>

                                        <!-- DECISION -->
                                            <button mat-button *ngIf="period(projet, projet.created_at | date: 'yyyy-MM-dd') == false &&
                                            (projet.status_decisions_on == 1 || projet.status_decisions_off == 1)" class="bg-success text-white rounded-pill ">
                                                <mat-icon class="fa-2x me-1">task</mat-icon>
                                                Terminé
                                            </button>

                                            <button mat-button *ngIf="period(projet, projet.created_at | date: 'yyyy-MM-dd')" class="bg-danger text-white rounded-pill ">
                                                <mat-icon class="fa-2x me-1">more_time</mat-icon>
                                                Suspendu
                                            </button>
                                    </td>
                                    <td class="text-center" *ngIf="_visitor == false">
                                        <button mat-mini-fab color="primary" [matMenuTriggerFor]="beforeMenu">
                                            <mat-icon class="text-white">more_horiz</mat-icon>
                                        </button>
                                        <mat-menu #beforeMenu="matMenu" xPosition="before">
                                            <button mat-menu-item [routerLink]="['/web.administration.non-commercial.show-project-seleted-details', projet.project_code]"> <mat-icon
                                                    class="mat-18">visibility</mat-icon> Voir contenu</button>
                                            <button mat-menu-item *ngIf="projet.status == 0" (click)="asignedAsEvaluator(projet)"><mat-icon
                                                    class="mat-18">person_search</mat-icon>Imputation</button>
                                        </mat-menu>
                                    </td>
                                </tr>
                                <tr class="" *ngIf="is_loading_data == true">
                                    <td colspan="6">
                                        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
                                    </td>
                                </tr>
                                <tr class="" *ngIf="_liste_global_projet.length == 0 && is_loading_data == false">
                                    <td colspan="6">
                                        <div class="text-center">
                                            <i class="fa fa-ban text-danger fa-2x"></i>
                                            <p class="mt-2 text-danger">Aucun élément trouvés</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="container text-end mt-3">
                        <pagination-controls (pageChange)="p = $event" previousLabel="Précédent" nextLabel="Suivant">
                        </pagination-controls>
                    </div>
                </div>
            </div>
        </div>

        <app-assigned-projets-non-commercials *ngIf="is_assigned_projet == true"></app-assigned-projets-non-commercials>
    </div>
</div>
